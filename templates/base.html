<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universitaria de Colombia - {% block title %}{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/estilos.css') }}">
    <style>
        body {
            background: linear-gradient(135deg, #4576d1 0%, #828f9f 100%);
            min-height: 100vh;
        }
        
        .navbar-brand img {
            filter: brightness(1.1);
        }
        
        .main-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body class="text-white">

    <header class="text-center py-4">
        <img src="{{ url_for('static', filename='img/imagenlogop2.png') }}" alt="Logo Universitaria de Colombia" width="220" class="mb-3">
        <h1 class="display-4 fw-bold">Universitaria de Colombia</h1>
        <p class="lead">Excelencia Académica y Formación Integral</p>
    </header>

    <nav class="navbar navbar-expand-sm navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <ul class="navbar-nav mx-auto">
                <li class="nav-item mx-2">
                    <a class="nav-link px-3" href="{{ url_for('mision') }}">Misión</a>
                </li>
                <li class="nav-item mx-2">
                    <a class="nav-link px-3" href="{{ url_for('vision') }}">Visión</a>
                </li>
                <li class="nav-item mx-2">
                    <a class="nav-link px-3" href="{{ url_for('programas') }}">Programas</a>
                </li>
                <li class="nav-item mx-2">
                    <a class="nav-link px-3" href="{{ url_for('listacarreras') }}">Carreras</a>
                </li>
            </ul>
        </div>
    </nav>

    <main class="container">
        <div class="main-content">
            {% block content %}{% endblock %}
        </div>
    </main>

    <footer class="bg-dark text-center text-white py-4 mt-5">
        <div class="container">
            <p class="mb-2">© 2024 Universitaria de Colombia. Todos los derechos reservados.</p>
            <a href="https://www.google.com" class="text-white text-decoration-none">Visítenos en Internet</a>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chat widget: floating button + panel -->
    <div id="chat-widget" aria-hidden="true">
        <button id="chat-open-btn" aria-label="Abrir chat" title="Abrir chat">
            <img src="{{ url_for('static', filename='img/imagenlogop2.png') }}" alt="chat" style="width:28px; height:28px;"> 
        </button>

        <div id="chat-panel" role="dialog" aria-modal="false">
            <div id="chat-header">
                <strong>Chat</strong>
                <button id="chat-close-btn" aria-label="Cerrar chat">✕</button>
            </div>
            <div id="chat-messages"></div>
            <form id="chat-inline-form">
                <input id="chat-inline-input" type="text" placeholder="Escribe tu pregunta..." autocomplete="off">
                <button type="submit">Enviar</button>
            </form>
            <div class="chat-note small">Usa el chat para preguntar; la integración con Gemini se realiza en <code>/api/chat</code></div>
        </div>
    </div>

    <!-- Load Marked (markdown) and DOMPurify for safe client-side rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
    <script>
    // Chat widget behavior: abrir/cerrar y enviar preguntas a /api/chat
    (function(){
        const openBtn = document.getElementById('chat-open-btn');
        const closeBtn = document.getElementById('chat-close-btn');
        const panel = document.getElementById('chat-panel');
        const widget = document.getElementById('chat-widget');
        const messages = document.getElementById('chat-messages');
        const form = document.getElementById('chat-inline-form');
        const input = document.getElementById('chat-inline-input');

        function openPanel(){
            panel.style.display = 'flex';
            widget.setAttribute('aria-hidden','false');
            input.focus();
        }

        function closePanel(){
            panel.style.display = 'none';
            widget.setAttribute('aria-hidden','true');
        }

        openBtn.addEventListener('click', openPanel);
        closeBtn.addEventListener('click', closePanel);

        form.addEventListener('submit', async function(e){
            e.preventDefault();
            const text = input.value.trim();
            if(!text) return;

            // Mostrar mensaje del usuario
            const u = document.createElement('div'); u.className = 'chat-msg chat-user'; u.textContent = text; messages.appendChild(u);
            messages.scrollTop = messages.scrollHeight;

            // Llamar al endpoint local /api/chat (placeholder). Reemplaza este endpoint
            try{
                const resp = await fetch('/api/chat', {
                    method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({message: text})
                });
                const data = await resp.json();
                const b = document.createElement('div'); b.className = 'chat-msg chat-bot';
                try{
                    const md = data.reply || '(sin respuesta)';
                    const html = DOMPurify.sanitize(marked.parse(md));
                    b.innerHTML = html;
                }catch(err){
                    b.textContent = data.reply || '(sin respuesta)';
                }
                messages.appendChild(b);
                messages.scrollTop = messages.scrollHeight;
            }catch(err){
                const errDiv = document.createElement('div'); errDiv.className='chat-msg chat-bot'; errDiv.textContent = 'Error al contactar el servicio de chat'; messages.appendChild(errDiv);
            }

            input.value = '';
        });

        // init: panel oculto
        closePanel();
    })();
    </script>
</body>
</html>